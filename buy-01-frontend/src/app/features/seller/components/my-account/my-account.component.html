<div class="my-account-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <button class="back-button" (click)="goBack()" type="button">
        <lucide-icon [img]="X" class="back-icon"></lucide-icon>
        Back to Products
      </button>
      <h1 class="page-title">My Account</h1>
      <p class="page-subtitle">Manage your profile information</p>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading && !userProfile" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading your profile...</p>
  </div>

  <!-- Profile Content -->
  <div *ngIf="userProfile" class="profile-container">
    <!-- Profile Card -->
    <div class="profile-card">
      <!-- Avatar Section -->
      <div class="avatar-section">
        <div class="avatar-container">
          <div class="avatar" [class.has-image]="getAvatarUrl()">
            <img *ngIf="getAvatarUrl()" [src]="getAvatarUrl()" [alt]="userProfile.name" class="avatar-image">
            <lucide-icon *ngIf="!getAvatarUrl()" [img]="User" class="avatar-icon"></lucide-icon>
          </div>
          <div *ngIf="isEditMode && canEditAvatar()" class="avatar-upload">
            <label for="avatar-input" class="upload-label">
              <lucide-icon [img]="Camera" class="camera-icon"></lucide-icon>
              <span>Change Photo</span>
            </label>
            <input 
              type="file" 
              id="avatar-input" 
              accept="image/*" 
              (change)="onFileSelected($event)"
              class="file-input">
            
            <!-- Remove Avatar Button -->
            <button 
              *ngIf="getAvatarUrl()" 
              type="button" 
              class="remove-avatar-btn"
              (click)="removeAvatar()"
              [disabled]="isLoading">
              <lucide-icon [img]="X" class="remove-icon"></lucide-icon>
              <span>Remove Photo</span>
            </button>
          </div>
          
          <!-- Avatar restriction message for non-sellers -->
          <div *ngIf="isEditMode && !canEditAvatar()" class="avatar-restriction">
            <p class="restriction-text">
              <lucide-icon [img]="User" class="restriction-icon"></lucide-icon>
              Avatar changes are only available for seller accounts
            </p>
          </div>
        </div>
      </div>

      <!-- Profile Information -->
      <div class="profile-info">
        <div *ngIf="!isEditMode" class="view-mode">
          <!-- Name -->
          <div class="info-item">
            <div class="info-label">
              <lucide-icon [img]="User" class="info-icon"></lucide-icon>
              Full Name
            </div>
            <div class="info-value">{{ userProfile.name }}</div>
          </div>

            <!-- Email (Read-only in view mode) -->
            <div class="info-item">
              <div class="info-label">
                <lucide-icon [img]="Mail" class="info-icon"></lucide-icon>
                Email Address
              </div>
              <div class="info-value">{{ userProfile.email }}</div>
            </div>          <!-- Role -->
          <div class="info-item">
            <div class="info-label">
              <lucide-icon [img]="User" class="info-icon"></lucide-icon>
              Account Type
            </div>
            <div class="info-value">
              <span class="role-badge" [class]="'role-' + userProfile.role.toLowerCase()">
                {{ getRoleDisplayName() }}
              </span>
            </div>
          </div>

          <!-- Edit Button -->
          <div class="action-buttons">
            <button class="btn btn-primary" (click)="toggleEditMode()">
              <lucide-icon [img]="Edit3" class="btn-icon"></lucide-icon>
              Edit Profile
            </button>
          </div>
        </div>

        <!-- Edit Form -->
        <div *ngIf="isEditMode" class="edit-mode">
          <form [formGroup]="editForm" (ngSubmit)="saveProfile()" class="edit-form">
            <!-- Name Field -->
            <div class="form-group">
              <label for="name" class="form-label">
                <lucide-icon [img]="User" class="label-icon"></lucide-icon>
                Full Name *
              </label>
              <input
                type="text"
                id="name"
                formControlName="name"
                class="form-input"
                [class.error]="isFieldInvalid('name')"
                placeholder="Enter your full name">
              <div class="error-message" *ngIf="isFieldInvalid('name')">
                {{ getFieldError('name') }}
              </div>
            </div>

            <!-- Password Field -->
            <div class="form-group">
              <label for="password" class="form-label">
                <lucide-icon [img]="Key" class="label-icon"></lucide-icon>
                Password
              </label>
              <input
                type="password"
                id="password"
                formControlName="password"
                class="form-input"
                [class.error]="isFieldInvalid('password')"
                placeholder="Enter new password (leave empty to keep current)">
              <div class="error-message" *ngIf="isFieldInvalid('password')">
                {{ getFieldError('password') }}
              </div>
              <div class="field-hint">
                Leave empty to keep your current password
              </div>
            </div>

            <!-- Email Field (Read-only) -->
            <div class="form-group">
              <label class="form-label">
                <lucide-icon [img]="Mail" class="label-icon"></lucide-icon>
                Email Address
              </label>
              <div class="form-input-readonly">
                {{ userProfile.email }}
                <span class="readonly-hint">Email cannot be changed</span>
              </div>
            </div>

            <!-- Role Display (read-only) -->
            <div class="form-group">
              <label class="form-label">
                <lucide-icon [img]="User" class="label-icon"></lucide-icon>
                Account Type
              </label>
              <div class="form-input-readonly">
                <span class="role-badge" [class]="'role-' + userProfile.role.toLowerCase()">
                  {{ getRoleDisplayName() }}
                </span>
                <span class="readonly-hint">Account type cannot be changed</span>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" (click)="cancelEdit()" [disabled]="isLoading">
                <lucide-icon [img]="X" class="btn-icon"></lucide-icon>
                Cancel
              </button>
              <button type="submit" class="btn btn-primary" [disabled]="isLoading || editForm.invalid">
                <lucide-icon [img]="Save" class="btn-icon"></lucide-icon>
                <span *ngIf="!isLoading">Save Changes</span>
                <span *ngIf="isLoading">Saving...</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
