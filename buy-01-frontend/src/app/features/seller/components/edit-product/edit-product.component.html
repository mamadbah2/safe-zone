<div class="edit-product-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <button class="back-btn" (click)="onCancel()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12,19 5,12 12,5"></polyline>
        </svg>
        Back to My Products
      </button>
      <h1 class="page-title">Edit Product</h1>
      <p class="page-subtitle" *ngIf="product">
        Update your product information and images
      </p>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p class="loading-text">Loading product details...</p>
  </div>

  <!-- Error Message -->
  <div class="alert alert-error" *ngIf="errorMessage">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="15" y1="9" x2="9" y2="15"></line>
      <line x1="9" y1="9" x2="15" y2="15"></line>
    </svg>
    {{ errorMessage }}
  </div>

  <!-- Success Message -->
  <div class="alert alert-success" *ngIf="successMessage">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="20,6 9,17 4,12"></polyline>
    </svg>
    {{ successMessage }}
  </div>

  <!-- Edit Form -->
  <div class="edit-form-container" *ngIf="!isLoading && product">
    <form [formGroup]="editForm" (ngSubmit)="onSubmit()" class="edit-form">

      <!-- Product Information Section -->
      <div class="form-section">
        <h2 class="section-title">Product Information</h2>

        <div class="form-row">
          <div class="form-group">
            <label for="name" class="form-label">Product Name *</label>
            <input
              type="text"
              id="name"
              formControlName="name"
              class="form-input"
              [class.error]="isFieldInvalid('name')"
              placeholder="Enter product name">
            <div class="error-message" *ngIf="isFieldInvalid('name')">
              {{ getFieldError('name') }}
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="description" class="form-label">Description *</label>
            <textarea
              id="description"
              formControlName="description"
              class="form-textarea"
              [class.error]="isFieldInvalid('description')"
              placeholder="Describe your product in detail..."
              rows="4"></textarea>
            <div class="error-message" *ngIf="isFieldInvalid('description')">
              {{ getFieldError('description') }}
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="price" class="form-label">Price (XOF) *</label>
            <div class="input-group">
              <input
                type="number"
                id="price"
                formControlName="price"
                class="form-input"
                [class.error]="isFieldInvalid('price')"
                placeholder="0"
                min="0"
                step="0.01">
              <span class="currency-suffix">XOF</span>
            </div>
            <div class="error-message" *ngIf="isFieldInvalid('price')">
              {{ getFieldError('price') }}
            </div>
          </div>

          <div class="form-group">
            <label for="quantity" class="form-label">Quantity *</label>
            <input
              type="number"
              id="quantity"
              formControlName="quantity"
              class="form-input"
              [class.error]="isFieldInvalid('quantity')"
              placeholder="0"
              min="1"
              step="1">
            <div class="error-message" *ngIf="isFieldInvalid('quantity')">
              {{ getFieldError('quantity') }}
            </div>
          </div>
        </div>
      </div>

      <!-- Current Images Section -->
      <div class="form-section" *ngIf="existingImages.length > 0">
        <h2 class="section-title">
          Current Images
          <span class="image-counter">({{ existingImages.length }})</span>
        </h2>
        <div class="current-images-grid">
          <div class="current-image-item" *ngFor="let image of existingImages; let i = index">
            <img [src]="image.imageUrl" [alt]="'Product image ' + (i + 1)" class="current-image">
            <button
              type="button"
              class="remove-current-image"
              (click)="removeExistingImage(i)"
              [title]="'Remove image ' + (i + 1)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Add New Images Section -->
      <div class="form-section">
        <h2 class="section-title">
          Add New Images
          <span class="image-counter">({{ getTotalImages() }}/5)</span>
        </h2>

        <!-- Image Requirements Notice -->
        <div class="image-requirements" *ngIf="getTotalImages() === 0">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          <span>At least one image is required for your product</span>
        </div>

        <div class="image-upload-section">
          <div class="upload-area" *ngIf="canAddMoreImages">
            <input
              type="file"
              id="images"
              accept="image/*"
              multiple
              (change)="onFileSelect($event)"
              class="file-input">
            <label for="images" class="upload-label">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="9" cy="9" r="2"></circle>
                <path d="M21 15l-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path>
              </svg>
              <span class="upload-text">Click to add new images</span>
              <span class="upload-hint">PNG, JPG, GIF up to 5MB each</span>
            </label>
          </div>

          <div class="max-images-notice" *ngIf="!canAddMoreImages">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            <span>Maximum of 5 images reached</span>
          </div>

          <!-- New Image Previews -->
          <div class="image-previews" *ngIf="imagePreviewUrls.length > 0">
            <h3 class="preview-title">New Images to Add</h3>
            <div class="preview-grid">
              <div class="image-preview" *ngFor="let url of imagePreviewUrls; let i = index">
                <img [src]="url" [alt]="'New image ' + (i + 1)" class="preview-image">
                <button
                  type="button"
                  class="remove-image"
                  (click)="removeNewImage(i)"
                  [title]="'Remove image ' + (i + 1)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Image Validation Summary -->
      <div class="form-section">
        <div class="image-validation-summary">
          <div class="validation-item" [class.valid]="hasMinimumImages()" [class.invalid]="!hasMinimumImages()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="hasMinimumImages()">
              <polyline points="20,6 9,17 4,12"></polyline>
            </svg>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="!hasMinimumImages()">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="15" y1="9" x2="9" y2="15"></line>
              <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
            <span>Product has {{ getTotalImages() }} image(s) - Minimum 1 required</span>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="onCancel()"
          [disabled]="isSubmitting">
          Cancel
        </button>

        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="editForm.invalid || isSubmitting || !hasMinimumImages()">
          <span *ngIf="!isSubmitting">Update Product</span>
          <span *ngIf="isSubmitting">
            <svg class="animate-spin" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
            </svg>
            Updating...
          </span>
        </button>
      </div>
    </form>
  </div>
</div>
