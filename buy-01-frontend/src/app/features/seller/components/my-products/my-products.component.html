<div class="my-products-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="breadcrumb">
        <span class="breadcrumb-item">Seller Dashboard</span>
        <span class="breadcrumb-separator">></span>
        <span class="breadcrumb-item current">My Products</span>
      </div>
      <h1 class="page-title">My Products</h1>
      <p class="page-subtitle">Manage your product inventory and track performance</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="refreshProducts()">
        <span class="btn-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23,4 23,10 17,10"></polyline>
            <polyline points="1,20 1,14 7,14"></polyline>
            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
          </svg>
        </span>
        Refresh
      </button>
      <button class="btn btn-primary" routerLink="/seller/create-product">
        <span class="btn-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
        </span>
        Add Product
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon total">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"></path>
          <path d="m3.3 7 8.7 5 8.7-5"></path>
          <path d="M12 22V12"></path>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ totalProducts }}</div>
        <div class="stat-label">Total Products</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon active">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="20,6 9,17 4,12"></polyline>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ activeProducts }}</div>
        <div class="stat-label">Active</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon inactive">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="6" y="4" width="4" height="16"></rect>
          <rect x="14" y="4" width="4" height="16"></rect>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ inactiveProducts }}</div>
        <div class="stat-label">Inactive</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon out-of-stock">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
      </div>
      <div class="stat-content">
        <div class="stat-value">{{ outOfStockProducts }}</div>
        <div class="stat-label">Out of Stock</div>
      </div>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="toolbar">
    <div class="search-section">
      <div class="search-box">
        <span class="search-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </span>
        <input
          type="text"
          placeholder="Search products by name or description..."
          class="search-input"
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
        />
        <button class="clear-search" *ngIf="searchTerm" (click)="clearSearch()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
    </div>

    <div class="filter-section">
      <div class="filter-group">
        <label class="filter-label">Category</label>
        <select class="filter-select" [(ngModel)]="selectedCategory" (change)="applyFilters()">
          <option value="all">All Categories</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Stock Status</label>
        <select class="filter-select" [(ngModel)]="selectedStatus" (change)="applyFilters()">
          <option value="all">All Status</option>
          <option value="active">In Stock</option>
          <option value="out_of_stock">Out of Stock</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Sort by</label>
        <select class="filter-select" [(ngModel)]="sortBy" (change)="applySort()">
          <option value="name">Name</option>
          <option value="price">Price</option>
          <option value="stock">Stock</option>
          <option value="updatedAt">Last Updated</option>
        </select>
      </div>

      <button class="sort-order-btn" (click)="toggleSortOrder()" [title]="sortOrder === 'asc' ? 'Sort Ascending' : 'Sort Descending'">
        <span *ngIf="sortOrder === 'asc'">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="19" x2="12" y2="5"></line>
            <polyline points="5,12 12,5 19,12"></polyline>
          </svg>
        </span>
        <span *ngIf="sortOrder === 'desc'">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <polyline points="19,12 12,19 5,12"></polyline>
          </svg>
        </span>
      </button>
    </div>
  </div>

  <!-- Results Summary -->
  <div class="results-bar" *ngIf="!isLoading">
    <div class="results-info">
      <span class="results-count">{{ filteredProducts.length }} of {{ totalProducts }} products</span>
      <span class="results-filters" *ngIf="hasActiveFilters()">
        â€¢ Filtered results
        <button class="clear-filters" (click)="clearAllFilters()">Clear all filters</button>
      </span>
    </div>
    <div class="view-toggle">
      <button class="view-btn" [class.active]="viewMode === 'grid'" (click)="setViewMode('grid')">
        <span class="view-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"></rect>
            <rect x="14" y="3" width="7" height="7"></rect>
            <rect x="14" y="14" width="7" height="7"></rect>
            <rect x="3" y="14" width="7" height="7"></rect>
          </svg>
        </span>
      </button>
      <button class="view-btn" [class.active]="viewMode === 'list'" (click)="setViewMode('list')">
        <span class="view-icon">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="8" y1="6" x2="21" y2="6"></line>
            <line x1="8" y1="12" x2="21" y2="12"></line>
            <line x1="8" y1="18" x2="21" y2="18"></line>
            <line x1="3" y1="6" x2="3.01" y2="6"></line>
            <line x1="3" y1="12" x2="3.01" y2="12"></line>
            <line x1="3" y1="18" x2="3.01" y2="18"></line>
          </svg>
        </span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p class="loading-text">Loading your products...</p>
  </div>

  <!-- Empty States -->
  <div class="empty-state" *ngIf="!isLoading && filteredProducts.length === 0 && totalProducts === 0">
    <div class="empty-icon">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"></path>
        <path d="m3.3 7 8.7 5 8.7-5"></path>
        <path d="M12 22V12"></path>
      </svg>
    </div>
    <h3 class="empty-title">No products yet</h3>
    <p class="empty-description">
      Start building your store by adding your first product. You can upload images, set prices, and manage inventory all in one place.
    </p>
    <button class="btn btn-primary" routerLink="/seller/create-product">
      <span class="btn-icon">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      </span>
      Add Your First Product
    </button>
  </div>

  <!-- No Results State -->
  <div class="empty-state" *ngIf="!isLoading && filteredProducts.length === 0 && totalProducts > 0">
    <div class="empty-icon">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
    </div>
    <h3 class="empty-title">No products found</h3>
    <p class="empty-description">
      We couldn't find any products matching your current filters. Try adjusting your search terms or clearing some filters.
    </p>
    <button class="btn btn-secondary" (click)="clearAllFilters()">Clear All Filters</button>
  </div>

  <!-- Products Grid View -->
  <div class="products-grid" *ngIf="!isLoading && filteredProducts.length > 0 && viewMode === 'grid'">
    <div class="product-card" *ngFor="let product of filteredProducts; trackBy: trackByProductId">
      <!-- Product Image -->
      <div class="product-image-container">
        <img
          [src]="getProductImage(product)"
          [alt]="product.name"
          class="product-image"
          (error)="onImageError($event)"
        />
        <div class="product-status" [ngClass]="getStatusClass(product.quantity)">
          <span class="status-dot"></span>
          <span class="status-text">{{ getStatusLabel(product.quantity) }}</span>
        </div>
        <div class="product-overlay">
          <button class="overlay-btn" (click)="editProduct(product.id); $event.stopPropagation()" title="Edit Product" type="button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>
          <button class="overlay-btn" (click)="viewProduct(product.id); $event.stopPropagation()" title="View Product" type="button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
          </button>
        </div>
      </div>

      <!-- Product Info -->
      <div class="product-content">
        <h3 class="product-name">{{ product.name }}</h3>
        <p class="product-description">{{ truncateDescription(product.description) }}</p>

        <div class="product-details">
          <div class="price-section">
            <span class="product-price">{{ formatCurrency(product.price) }}</span>
            <span class="price-currency">XOF</span>
          </div>
          <div class="stock-section" [ngClass]="getStockClass(product.quantity)">
            <span class="stock-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"></path>
                <path d="m3.3 7 8.7 5 8.7-5"></path>
                <path d="M12 22V12"></path>
              </svg>
            </span>
            <span class="stock-text">{{ product.quantity }} in stock</span>
          </div>
        </div>

        <div class="product-meta">
          <span class="product-id">ID: {{ product.id.substring(0, 8) }}...</span>
          <span class="product-price-small">{{ formatCurrency(product.price) }}</span>
        </div>

        <!-- Product Actions -->
        <div class="product-actions">
          <button
            class="action-btn primary"
            (click)="editProduct(product.id); $event.stopPropagation()"
            type="button"
            style="z-index: 10; position: relative;">
            <span class="action-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
            </span>
            Edit
          </button>

          <button
            class="action-btn danger"
            (click)="deleteProduct(product.id); $event.stopPropagation()"
            type="button"
            style="z-index: 10; position: relative;">
            <span class="action-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3,6 5,6 21,6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
              </svg>
            </span>
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Products List View -->
  <div class="products-list" *ngIf="!isLoading && filteredProducts.length > 0 && viewMode === 'list'">
    <div class="list-header">
      <div class="list-col col-product">Product</div>
      <div class="list-col col-price">Price</div>
      <div class="list-col col-stock">Stock</div>
      <div class="list-col col-status">Status</div>
      <div class="list-col col-updated">Updated</div>
      <div class="list-col col-actions">Actions</div>
    </div>

    <div class="list-item" *ngFor="let product of filteredProducts; trackBy: trackByProductId">
      <div class="list-col col-product">
        <div class="product-summary">
          <img [src]="getProductImage(product)" [alt]="product.name" class="list-product-image" />
          <div class="product-info">
            <h4 class="product-name">{{ product.name }}</h4>
            <p class="product-description">{{ truncateDescription(product.description, 30) }}</p>
          </div>
        </div>
      </div>
      <div class="list-col col-price">
        <span class="product-price">{{ formatCurrency(product.price) }}</span>
      </div>
      <div class="list-col col-stock" [ngClass]="getStockClass(product.quantity)">
        <span class="stock-value">{{ product.quantity }}</span>
      </div>
      <div class="list-col col-status">
        <span class="status-badge" [ngClass]="getStatusClass(product.quantity)">
          {{ getStatusLabel(product.quantity) }}
        </span>
      </div>
      <div class="list-col col-date">
        <span class="date-text">{{ product.id.substring(0, 8) }}...</span>
      </div>
      <div class="list-col col-actions">
        <div class="action-menu">
          <button class="action-btn-sm" (click)="editProduct(product.id)" title="Edit">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>

          <button class="action-btn-sm danger" (click)="deleteProduct(product.id)" title="Delete">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3,6 5,6 21,6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
          </button>
        </div>
      </div>
    </div>

  </div>

  <!-- Pagination (if needed) -->
  <div class="pagination-container" *ngIf="!isLoading && filteredProducts.length > 0">
    <div class="pagination-info">
      Showing {{ getStartIndex() }}-{{ getEndIndex() }} of {{ totalProducts }} products
    </div>
    <!-- Add pagination controls here if needed -->
  </div>

  <!-- Confirmation Modal -->
  <app-confirmation-modal
    [isVisible]="showConfirmModal"
    [data]="confirmModalData"
    [isProcessing]="isDeleting"
    (confirm)="onConfirmDelete()"
    (cancel)="onCancelDelete()">
  </app-confirmation-modal>
</div>
